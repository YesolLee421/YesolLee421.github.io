---
title: "WILT-200109"
categories:
  - What I Learned Today
comments : true
tags:
  - REST
  - JSON
  - node.js
  - sequelize
  - MySQL
  - MariaDB
---

### 오늘 한 일
----
1. 협업 프로젝트: S3 파일 업로드, 파일 삭제 모듈 수정 및 통합
    - 기존에 마이페이지 프로필 수정(삭제), 게시물 사진, 음성, 영상 업로드 및 삭제 파일에 전부 S3 업로드 및 삭제 코드가 있어서 코드 중복이 많았다.
    - 따로 한 이유는 파일 유형마다 `파일 개수`, `저장경로` 및 `용량제한`이 달랐기 때문이다.<br>
    - **<변경사항>**
        1. `board/ picture, video, record` 에 쓰이는 `s3 upload`, `delete` 부분을 빼고 `S3.js`파일의 모듈로 대체했습니다. (코드 중복수정)
        2. 업로드 시 다양한 파일 양식에 맞게 쓰기 위해 `파일타입`, `파일 최대용량` 변수를 받습니다. : `upload_s3_test(type, fileSize)`
        3. 파일 삭제 시 파일 개수에 상관없이 삭제할 파일의 `key`를 배열 `deleteItems` 에 저장하고 `deleteS3Obj(deleteItems)` 함수에 전달합니다. 함수 안에서 배열을 돌면서 파일 하나씩 있는지 확인 후 삭제합니다. 파일 삭제 시 파일 명을 로그로 확인할 수 있습니다.
    - **<테스트결과>**
        1. **로컬**: `마이페이지 프로필 사진 수정(삭제)`, `게시물 사진`, `영상`, `음성 생성 및 수정(삭제)` 시 S3 업로드, 파일 삭제가 전부 정상작동합니다.
        2. **AWS 서버**: 시간 관계상 `마이페이지 프로필사진 수정(삭제)`만 테스트했는데 정상작동 했습니다. 같은 모듈을 사용하기 때문에 다른 부분도 아마 문제없을 것으로 예상됩니다.

> 원래 프로필사진 수정 시 사용했던 모듈을 복사, 붙여넣기 하면 될 줄 알았는데 업로드 및 삭제할 파일의 개수나 ContentType에 따라 변하는 값이 있어서 생각보다 오래 걸렸다. 그래도 덕분에 S3 Object를 처리하는 데에 조금 익숙해진 것 같다.