---
title: "[블록체인] 9주차_거래 정보의 구조"
categories:
  - BlockChain
tags:
  - BlockChain
  - 블록체인
  - K-MOOC

comments : true
---
*이 내용은 K-MOOC [알기쉬운블록체인] 강의를 듣고 정리한 내용입니다.*
<br>

[알기쉬운블록체인]: http://www.kmooc.kr/courses/course-v1:SJCU+SJCU01+2019_2/courseware/145ba5714d1246c1b65fe1b081d52db0/e1af1659e74343579fe5727acdfcfbc7/?child=last

<br>

# 거래 정보의 구성
## 블록체인이 풀어야 할 문제
### 1. 도서관의 도서 일람표 카드로 비유한 블록체인
- 분류방식: 저자 일람표(저자 이름순), 제목 일람표(제목 순), 출판일자 순
- 알람표 = 한 권의 책에 대한 정보: 저자 이름, 책 제목, 출판일, 책 위치, 고유 식별자

### 2. 블록체인의 목표
- 목표: 전체 거래 이력(transaction)을 순서대로 유지하는 것
- 해결할 문제
    1. 거래 정보를 발생 순서대로 유지
    2. 변경을 바로 감지하여 조작(manipulate), 위조(forge, counterfeit) 방지
- 해결 방법
    1. 거래 정보의 도서관 만들기
    2. 거래가 추가된 순서대로 정렬
    3. 모든 변경(알람표 순서, 개별 거래 정보 등)을 감지할 수 있도록 `해시값`으로 연결<br>

## 책의 변환: 책 구조를 블록체인으로 변환하기
### 1. 책의 구조
1. 내용: 각 페이지 단위로 내용 보관
2. 정렬
    - 책의 모든 페이지 정렬
    - 각 페이지 내 문장이 내용 순으로 정렬
3. 페이지의 연결
    - 물리적으로 책에 연결됨 (책등에 순서대로 붙어있음)
    - 논리적으로 내용-페이지 번호로 연결

### 2. 책의 변환 6단계
1. 페이지 의존성(dependency) 확보
    - 한 페이지: `페이지 번호` + `내용`
    - 페이지 번호: 페이지의 누락(omission)이나 중복(duplication), 순서바뀜(reversed)을 쉽게 확인<br>

2. 페이지 연결
    - 페이지 번호에 규칙성이 없는 경우? 페이지 누락, 중복 등을 확인하기 위한 방법 필요
    - 각 페이지가 바로 앞 페이지 번호 가짐: 전후관계 생성<br>

3. 페이지 내용 아웃소싱(페이지번호 / 내용 분리)
    - 페이지번호는 사이즈 일정, 하지만 내용은 임의 사이즈 -> 분리
    - 내용을 페이지 밖에 둠으로써 책은 오로지 순서 유지에 집중
    - 책 -> 내용 일람표 역할: 내용 고유 참조 값 가짐
    - 내용: 고유 참조 값(reference value)로 식별되는 별도 페이지에 저장
    - 내용 일부의 위조 여부를 알기 위해서 조치 필요<br>

4. 페이지 번호를 참조 값으로 대체
    - 자연수 -> 해시값을 페이지 참조값으로 사용<br>

5. 페이지 참조 값 생성 방법
    - 암호화 해시값 사용: 입력값 길이에 상관없이 출력값 길이는 일정
    - 페이지 내용 해시 + 페이지 번호 + 앞 페이지 번호 => 하나의 해시값 생성
    - 페이지 번호 참조 값 및 내용 참조값을 모두 해시값으로 사용하면 위조 쉽게 발견 가능
    - 페이지 내용 및 페이지 순서 변경 불가<br>

6. 파본
    - 페이지 내용 및 순서 변경 불가 & 참조값으로 찾기 가능
    - 즉 제본된 상태일 필요 없이 페이지 섞어도 순서 정보 유지
    - 순서 일람표의 **마지막 페이지**만 알고 있으면 이전 페이지 참조값 따라서 전체 페이지 순서 및 연결 구조 알 수 있음
    - 페이지 포함 내용 = 자기 페이지 참조값 + 이전 페이지 참조값 + 내용 페이지 참조값<br>

### 3. 블록체인-데이터-구조

| 성질 | 변환 전 책 | 변환 후 책 |
|:---:|:---|:---|
| 내용 저장 | 페이지 자체 | 별도 내용페이지 + 고유 참조값 |
| 페이지 연결 | 물리적&논리적(페이지 번호) | 논리적(참조값) | 
| 페이지 검색 | 전방&후방&직접 접근 가능 | 후방만 가능(직전페이지 참조값 따라가기) |

![9_1_3_변환전후책비교](https://user-images.githubusercontent.com/54266900/67277121-148bf600-f501-11e9-945d-a32072b1d7f0.PNG)

1. 순서일람표 페이지 -> 블록 헤더
2. 전체 순서 일람표 -> 블록 헤더의 체인
    - 참조를 통해 선형으로 연결됨
3. 순서일람표 페이지 참조값 -> 블록헤더의 암호화 해시값
4. 직전 페이지 참조값 -> 직전 블록헤더의 암호화 해시값
5. 내용 -> 트랜잭션 데이터(거래 기록)
    - 블록체인은 사실 *내용 페이지*가 별개로 존재하지 않음
    - 거래 정보들이 한 블록 단위가 아닌 전체 내용이 DB 같은데 저장됨
    - 논리적 `머클 트리`생성: 해당 머클트리 루트가 각 블록헤더에 저장
6. 내용 페이지 -> 트랜잭션 데이터 가진 머클 트리
7. 내용 페이지 참조값 -> 트랜잭션 데이터 가진 머클 트리 루트
8. 순서일람표 페이지+해당 내용 페이지 -> `블록체인-데이터-구조`의 한 블록
9. 전체 순서일람표+전체 내용 -> `블록체인-데이터-구조`






